<!--  Views/MainWindow.xaml  -->
<Window
    x:Class="WinLauncher.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:WinLauncher.Common.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="LaunchNext"
    Width="900"
    Height="700"
    MinWidth="800"
    MinHeight="600"
    AllowsTransparency="True"
    Background="Transparent"
    WindowStartupLocation="CenterScreen"
    WindowStyle="None"
    mc:Ignorable="d">
    <Window.Resources>
        <c:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
    </Window.Resources>

    <!--  窗口阴影  -->
    <Window.Effect>
        <DropShadowEffect
            BlurRadius="30"
            Opacity="0.6"
            ShadowDepth="0"
            Color="#40000000" />
    </Window.Effect>

    <Grid>
        <!--  背景层  -->
        <Border
            Background="#F8FAFC"
            CornerRadius="24"
            Opacity="0.98">
            <Border.Effect>
                <BlurEffect Radius="20" />
            </Border.Effect>
        </Border>

        <!--  主要内容区域  -->
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  顶部搜索栏  -->
            <Border
                Grid.Row="0"
                Margin="0,0,0,20"
                Padding="2"
                Background="White"
                BorderBrush="#E2E8F0"
                BorderThickness="1"
                CornerRadius="16">
                <Border.Effect>
                    <DropShadowEffect
                        BlurRadius="15"
                        Opacity="0.3"
                        ShadowDepth="0"
                        Color="#10000000" />
                </Border.Effect>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!--  搜索图标  -->
                    <Viewbox
                        Grid.Column="0"
                        Width="20"
                        Height="20"
                        Margin="16,12"
                        VerticalAlignment="Center">
                        <Path
                            Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                            Fill="#64748B"
                            Stretch="Uniform" />
                    </Viewbox>

                    <!--  搜索框  -->
                    <TextBox
                        Grid.Column="1"
                        Padding="0,12"
                        VerticalContentAlignment="Center"
                        Background="Transparent"
                        BorderThickness="0"
                        CaretBrush="#3B82F6"
                        FontSize="16"
                        Foreground="#1E293B"
                        Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Text" Value="搜索应用..." />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SearchText}" Value="">
                                        <Setter Property="Foreground" Value="#94A3B8" />
                                    </DataTrigger>
                                    <Trigger Property="IsFocused" Value="True">
                                        <Setter Property="Text" Value="{Binding SearchText}" />
                                        <Setter Property="Foreground" Value="#1E293B" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>

                    <!--  清除按钮  -->
                    <Button
                        Grid.Column="2"
                        Padding="16,12"
                        VerticalAlignment="Center"
                        Background="Transparent"
                        BorderThickness="0"
                        Command="{Binding ClearSearchCommand}"
                        Content="✕"
                        FontSize="14"
                        Foreground="#94A3B8"
                        Visibility="{Binding SearchText, Converter={StaticResource StringToVisibilityConverter}}">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Cursor" Value="Hand" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Foreground" Value="#64748B" />
                                        <Setter Property="Background" Value="#F1F5F9" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>

            <!--  应用网格区域  -->
            <ScrollViewer
                Grid.Row="1"
                Padding="5"
                HorizontalScrollBarVisibility="Disabled"
                VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Items}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel
                                HorizontalAlignment="Center"
                                ItemHeight="140"
                                ItemWidth="120"
                                Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <!--  应用项容器  -->
                            <Border
                                Margin="8"
                                Background="Transparent"
                                Cursor="Hand">
                                <Border.Resources>
                                    <Storyboard x:Key="HoverAnimation">
                                        <DoubleAnimation
                                            Storyboard.TargetProperty="RenderTransform.ScaleX"
                                            To="1.05"
                                            Duration="0:0:0.2" />
                                        <DoubleAnimation
                                            Storyboard.TargetProperty="RenderTransform.ScaleY"
                                            To="1.05"
                                            Duration="0:0:0.2" />
                                    </Storyboard>
                                    <Storyboard x:Key="LeaveAnimation">
                                        <DoubleAnimation
                                            Storyboard.TargetProperty="RenderTransform.ScaleX"
                                            To="1.0"
                                            Duration="0:0:0.2" />
                                        <DoubleAnimation
                                            Storyboard.TargetProperty="RenderTransform.ScaleY"
                                            To="1.0"
                                            Duration="0:0:0.2" />
                                    </Storyboard>
                                </Border.Resources>

                                <Border.RenderTransform>
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                </Border.RenderTransform>

                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Trigger.EnterActions>
                                                    <BeginStoryboard Storyboard="{StaticResource HoverAnimation}" />
                                                </Trigger.EnterActions>
                                                <Trigger.ExitActions>
                                                    <BeginStoryboard Storyboard="{StaticResource LeaveAnimation}" />
                                                </Trigger.ExitActions>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <!--  应用图标容器  -->
                                    <Border
                                        Grid.Row="0"
                                        Margin="0,0,0,8"
                                        Background="White"
                                        BorderBrush="#F1F5F9"
                                        BorderThickness="1"
                                        CornerRadius="20">
                                        <Border.Effect>
                                            <DropShadowEffect
                                                BlurRadius="20"
                                                Opacity="0.3"
                                                ShadowDepth="0"
                                                Color="#10000000" />
                                        </Border.Effect>

                                        <Viewbox
                                            Width="48"
                                            Height="48"
                                            Margin="24">
                                            <Image RenderOptions.BitmapScalingMode="HighQuality" Source="{Binding Icon}" />
                                        </Viewbox>
                                    </Border>

                                    <!--  应用名称  -->
                                    <TextBlock
                                        Grid.Row="1"
                                        MaxWidth="100"
                                        HorizontalAlignment="Center"
                                        FontSize="12"
                                        FontWeight="SemiBold"
                                        Foreground="#475569"
                                        LineHeight="16"
                                        LineStackingStrategy="BlockLineHeight"
                                        Text="{Binding DisplayName}"
                                        TextAlignment="Center"
                                        TextWrapping="Wrap" />
                                </Grid>

                                <!--  点击命令  -->
                                <!--  修正：使用统一的点击命令  -->
                                <Border.InputBindings>
                                    <MouseBinding
                                        Command="{Binding DataContext.ItemClickCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}"
                                        MouseAction="LeftClick" />
                                </Border.InputBindings>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!--  底部页面指示器和操作栏  -->
            <Border
                Grid.Row="2"
                Margin="0,20,0,0"
                Padding="16,12"
                Background="White"
                BorderBrush="#E2E8F0"
                BorderThickness="1"
                CornerRadius="16">
                <Border.Effect>
                    <DropShadowEffect
                        BlurRadius="15"
                        Opacity="0.3"
                        ShadowDepth="0"
                        Color="#10000000" />
                </Border.Effect>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!--  左侧：应用计数  -->
                    <TextBlock
                        Grid.Column="0"
                        VerticalAlignment="Center"
                        FontSize="12"
                        Foreground="#64748B"
                        Text="{Binding Items.Count, StringFormat='{}共 {0} 个应用'}" />

                    <!--  中间：页面指示器  -->
                    <StackPanel
                        Grid.Column="1"
                        HorizontalAlignment="Center"
                        Orientation="Horizontal">
                        <Ellipse
                            Width="6"
                            Height="6"
                            Margin="4"
                            Fill="#3B82F6" />
                        <Ellipse
                            Width="6"
                            Height="6"
                            Margin="4"
                            Fill="#CBD5E1" />
                        <Ellipse
                            Width="6"
                            Height="6"
                            Margin="4"
                            Fill="#CBD5E1" />
                    </StackPanel>

                    <!--  右侧：设置按钮  -->
                    <Button
                        Grid.Column="2"
                        Padding="12,8"
                        HorizontalAlignment="Right"
                        Background="Transparent"
                        BorderThickness="0"
                        Content="⚙️"
                        Cursor="Hand"
                        FontSize="14">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Foreground" Value="#64748B" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Foreground" Value="#3B82F6" />
                                        <Setter Property="Background" Value="#F1F5F9" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>
        </Grid>

        <!--  窗口控制按钮  -->
        <StackPanel
            Margin="16"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Orientation="Horizontal">
            <Button
                Padding="12,6"
                Background="Transparent"
                BorderThickness="0"
                Click="MinimizeButton_Click"
                Content="─"
                Cursor="Hand"
                FontSize="12"
                Foreground="#64748B">
                <Button.Style>
                    <Style TargetType="Button">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F1F5F9" />
                                <Setter Property="Foreground" Value="#1E293B" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <Button
                Padding="12,6"
                Background="Transparent"
                BorderThickness="0"
                Click="CloseButton_Click"
                Content="✕"
                Cursor="Hand"
                FontSize="12"
                Foreground="#64748B">
                <Button.Style>
                    <Style TargetType="Button">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FEF2F2" />
                                <Setter Property="Foreground" Value="#DC2626" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>
    </Grid>
</Window>
